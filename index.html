<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Group Coursework 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style type="text/tailwindcss">
      @layer components {
        .responsive-container {
          @apply px-6 mx-auto max-w-full lg:px-12 py-4;
        }
      }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#1ABC9C",
            },
          },
        },
      };
    </script>
  </head>
  <body>
    <div id="app">
      <header>
        <nav
          class="bg-white border-gray-200 dark:bg-gray-800 responsive-container"
        >
          <div
            class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"
          >
            <a href="/" class="flex items-center">
              <img
                src="https://ik.imagekit.io/fmxqscuev/icons8-lessons-64_pdvEMVgCW.png?ik-sdk-version=javascript-1.4.3&updatedAt=1666292631783"
                class="mr-3 h-6 sm:h-9"
                alt="Flowbite Logo"
              />
              <span
                class="self-center text-xl font-semibold whitespace-nowrap dark:text-white"
                >Coursework</span
              >
            </a>

            <button
              class="relative transition duration-200"
              :class="[cartLength <= 0 ? 'text-gray-500' : 'text-white']"
              :disabled="cartLength <= 0"
              @click.prevent="toggleCartDisplay"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-6 h-6"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"
                />
              </svg>
              <span
                class="absolute -top-2 -right-2 w-4 h-4 flex justify-center items-center bg-primary text-white text-xs rounded-full"
                >{{ cartLength }}</span
              >
            </button>
          </div>
        </nav>
      </header>

      <main class="mt-4">
        <div
          v-if="!isCartDisplaying"
          id="lessons"
          class="responsive-container flex sm:flex-row sm:justify-between sm:space-x-8 sm:space-y-0 flex-col space-y-8"
        >
          <div class="sm:w-1/5 space-y-6">
            <div class="space-y-4">
              <p class="text-base font-semibold tracking-wide">Filter by:</p>

              <div class="space-y-2">
                <div
                  v-for="(sortOption, index) in sortOptions"
                  :key="index"
                  class="flex items-center"
                >
                  <div>
                    <input
                      type="radio"
                      name="filter"
                      v-model="sortBy"
                      :value="sortOption"
                      :id="sortOption"
                      class="w-4 h-4 mr-3 checkbox appearance-none focus:ring-2 focus:ring-offset-2 focus:ring-primary rounded-full focus:outline-none border border-gray-400 checked:border-4 checked:border-primary cursor-pointer"
                    />
                  </div>
                  <label
                    :for="sortOption"
                    class="capitalize cursor-pointer"
                    :class="{'text-primary': sortBy === sortOption}"
                    >{{ sortOption }}</label
                  >
                </div>
              </div>
            </div>

            <div class="space-y-4">
              <p class="text-base font-semibold tracking-wide">Order by:</p>

              <div class="space-y-2">
                <div
                  v-for="(order, index) in orders"
                  :key="index"
                  class="flex items-center"
                >
                  <div>
                    <input
                      type="radio"
                      name="order"
                      v-model="orderBy"
                      :value="order.value"
                      :id="order.value"
                      class="w-4 h-4 mr-3 checkbox appearance-none focus:ring-2 focus:ring-offset-2 focus:ring-primary rounded-full focus:outline-none border border-gray-400 checked:border-4 checked:border-primary cursor-pointer"
                    />
                  </div>
                  <label
                    :for="order.value"
                    class="capitalize cursor-pointer"
                    :class="{'text-primary': orderBy === order.value}"
                    >{{ order.text }}</label
                  >
                </div>
              </div>
            </div>
          </div>

          <div class="sm:w-4/5 grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <div
              class="p-4 space-y-2 flex flex-col justify-between border-2 border-black rounded-xl"
              v-for="(lesson, index) in filteredLessons"
              :key="index"
            >
              <div class="flex justify-between space-x-6">
                <div class="space-y-1">
                  <p><strong>Subject:</strong> {{ lesson.subject }}</p>
                  <p><strong>Location:</strong> {{ lesson.location }}</p>
                  <p><strong>Price:</strong> £{{ lesson.price }}</p>
                  <p><strong>Spaces:</strong> {{ lesson.spaces }}</p>
                </div>

                <img
                  :src="lesson.image"
                  :alt="lesson.subject"
                  class="w-10 h-10"
                />
              </div>

              <div class="flex justify-end">
                <button
                  class="!mt-2 text-sm bg-primary p-1.5 rounded text-white transition duration-200 focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50"
                  :disabled="lesson.spaces <= 0"
                  v-on:click.prevent="addToCart(lesson.id)"
                >
                  Add to cart
                </button>
              </div>
            </div>
          </div>
        </div>

        <div
          v-else
          id="cart"
          class="responsive-container"
        >
          <h2 class="font-semibold text-xl uppercase tracking-wide block">Shopping Cart</h2>

          <div class="flex sm:flex-row sm:justify-between sm:space-x-8 sm:space-y-0 flex-col space-y-8 mt-4">

          <div class="sm:w-3/4 grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <div
              class="p-4 space-y-2 flex flex-col justify-between border-2 border-black rounded-xl"
              v-for="(item, index) in cart"
              :key="index"
            >
              <div class="flex justify-between space-x-6">
                <div class="space-y-1">
                  <p><strong>Subject:</strong> {{ item.subject }}</p>
                  <p><strong>Location:</strong> {{ item.location }}</p>
                  <p><strong>Price:</strong> £{{ item.price }}</p>
                  <p><strong>Spaces:</strong> {{ item.spaces }}</p>
                </div>

                <img
                  :src="item.image"
                  :alt="item.subject"
                  class="w-10 h-10"
                />
              </div>

              <div class="flex justify-end">
                <button
                  class="!mt-2 text-sm bg-primary p-1.5 rounded text-white transition duration-200 focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50"
                  v-on:click.prevent="removeFromCart(item.id)"
                >
                  Remove
                </button>
              </div>
            </div>
          </div>

          <div class="sm:w-1/4">

          </div>

          </div>
        </div>
      </main>
    </div>

    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
    <script type="module">
      import lessons from "./lessons.js";

      new Vue({
        el: "#app",
        data: {
          sortBy: "subject",
          orderBy: "asc",
          sortOptions: ["subject", "location", "price", "availability"],
          orders: [
            {
              text: "Ascending",
              value: "asc",
            },
            {
              text: "Descending",
              value: "desc",
            },
          ],
          cart: [],
          isCartDisplaying: false,
          lessons,
        },
        methods: {
          updateLessonSpaces(type, id) {
            console.log('in here')
            switch (type) {
              case 'decrease':
                this.lessons = this.lessons.map((item) => {
                  if (item.id === id && item.spaces > 0)
                    return { ...item, spaces: --item.spaces };

                  return item;
                });
                break;

              case 'reset':
                this.lessons = this.lessons.map((item) => {
                  if (item.id === id)
                    return { ...item, spaces: 5 };

                  return item;
                });
                break;
          
              default:
                break;
            }
          },
          isItemInCart(id) {
            return !!this.cart.find((item) => item.id === id);
          },
          addToCart(id) {
            const lesson = this.lessons.find((lesson) => lesson.id === id);

            if (!this.isItemInCart(lesson.id)) {
              this.cart.push({
                ...lesson,
                spaces: 1,
              });
            } else {
              if (lesson.spaces > 0) {
                this.cart = this.cart.map((item) => {
                  if (item.id === id) return { ...item, spaces: ++item.spaces };
                  return item;
                });
              }
            }

            this.updateLessonSpaces('decrease', lesson.id);
          },
          removeFromCart(id) {
            // get index of cart item
            const index = this.cart.findIndex(item => item.id === id)

            // remove item from cart
            this.cart.splice(index, 1)

            // update lesson spaces
            this.updateLessonSpaces('reset', id)

            // toggle cart display if no item is in cart
            if (!this.cart.length) this.toggleCartDisplay()
          },
          toggleCartDisplay() {
            this.isCartDisplaying = !this.isCartDisplaying;
          },
        },
        computed: {
          cartLength() {
            if (this.cart.length > 0)
              return this.cart.reduce((total, item) => total + item.spaces, 0);
            return 0;
          },
          filteredLessons() {
            if (this.orderBy === "asc") {
              // ascending
              switch (this.sortBy) {
                case "subject":
                  return this.lessons.sort((a, b) => {
                    if (a.subject.toLowerCase() > b.subject.toLowerCase())
                      return 1;
                    if (a.subject.toLowerCase() < b.subject.toLowerCase())
                      return -1;
                    return 0;
                  });
                case "location":
                  return this.lessons.sort((a, b) => {
                    if (a.location.toLowerCase() > b.location.toLowerCase())
                      return 1;
                    if (a.location.toLowerCase() < b.location.toLowerCase())
                      return -1;
                    return 0;
                  });
                case "price":
                  return this.lessons.sort((a, b) => {
                    if (a.price > b.price) return 1;
                    if (a.price < b.price) return -1;
                    return 0;
                  });
                case "availability":
                  return this.lessons.sort((a, b) => {
                    if (a.spaces > b.spaces) return 1;
                    if (a.spaces < b.spaces) return -1;
                    return 0;
                  });
              }
            } else if (this.orderBy === "desc") {
              // descending
              switch (this.sortBy) {
                case "subject":
                  return this.lessons.sort((a, b) => {
                    if (a.subject.toLowerCase() > b.subject.toLowerCase())
                      return -1;
                    if (a.subject.toLowerCase() < b.subject.toLowerCase())
                      return 1;
                    return 0;
                  });
                case "location":
                  return this.lessons.sort((a, b) => {
                    if (a.location.toLowerCase() > b.location.toLowerCase())
                      return -1;
                    if (a.location.toLowerCase() < b.location.toLowerCase())
                      return 1;
                    return 0;
                  });
                case "price":
                  return this.lessons.sort((a, b) => {
                    if (a.price > b.price) return -1;
                    if (a.price < b.price) return 1;
                    return 0;
                  });
                case "availability":
                  return this.lessons.sort((a, b) => {
                    if (a.spaces > b.spaces) return -1;
                    if (a.spaces < b.spaces) return 1;
                    return 0;
                  });
              }
            }
          },
        },
      });
    </script>
  </body>
</html>
